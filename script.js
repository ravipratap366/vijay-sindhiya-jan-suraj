// Enhanced JavaScript for Jan Suraj Party Campaign Website - Runnisaidpur Vidhan Sabha 29

// Initialize AOS (Animate On Scroll)
document.addEventListener('DOMContentLoaded', function() {
    if (typeof AOS !== 'undefined') {
        AOS.init({
            duration: 800,
            easing: 'ease-in-out',
            once: true,
            offset: 100
        });
    }
});

// Mobile Navigation
const hamburger = document.querySelector('.hamburger');
const navMenu = document.querySelector('.nav-menu');

if (hamburger && navMenu) {
    hamburger.addEventListener('click', () => {
        hamburger.classList.toggle('active');
        navMenu.classList.toggle('active');
    });

    // Close mobile menu when clicking on a link
    document.querySelectorAll('.nav-menu a').forEach(n => n.addEventListener('click', () => {
        hamburger.classList.remove('active');
        navMenu.classList.remove('active');
    }));
}

// Smooth scrolling for navigation links
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
            target.scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
        }
    });
});

// Enhanced Voter Data Search Functionality with Hindi-English Support
let voterData = [];
let searchStats = {
    totalSearches: 0,
    lastSearch: null,
    totalVoters: 0
};

// Hindi to English transliteration mapping
const hindiToEnglishMap = {
    // Vowels
    '‡§Ö': 'a', '‡§Ü': 'aa', '‡§á': 'i', '‡§à': 'ee', '‡§â': 'u', '‡§ä': 'oo', '‡§ã': 'ri', 
    '‡§è': 'e', '‡§ê': 'ai', '‡§ì': 'o', '‡§î': 'au',
    // Consonants
    '‡§ï': 'ka', '‡§ñ': 'kha', '‡§ó': 'ga', '‡§ò': 'gha', '‡§ô': 'nga',
    '‡§ö': 'cha', '‡§õ': 'chha', '‡§ú': 'ja', '‡§ù': 'jha', '‡§û': 'nya',
    '‡§ü': 'ta', '‡§†': 'tha', '‡§°': 'da', '‡§¢': 'dha', '‡§£': 'na',
    '‡§§': 'ta', '‡§•': 'tha', '‡§¶': 'da', '‡§ß': 'dha', '‡§®': 'na',
    '‡§™': 'pa', '‡§´': 'pha', '‡§¨': 'ba', '‡§≠': 'bha', '‡§Æ': 'ma',
    '‡§Ø': 'ya', '‡§∞': 'ra', '‡§≤': 'la', '‡§µ': 'va', '‡§∂': 'sha',
    '‡§∑': 'sha', '‡§∏': 'sa', '‡§π': 'ha',
    // Numbers
    '‡•¶': '0', '‡•ß': '1', '‡•®': '2', '‡•©': '3', '‡•™': '4', '‡•´': '5', '‡•¨': '6', '‡•≠': '7', '‡•Æ': '8', '‡•Ø': '9'
};

// English to Hindi transliteration mapping (reverse)
const englishToHindiMap = Object.fromEntries(
    Object.entries(hindiToEnglishMap).map(([hindi, english]) => [english, hindi])
);

// Common name variations for better search
const nameVariations = {
    // Hindi variations
    '‡§∞‡§æ‡§Æ': ['ram', 'raam'], '‡§∂‡•ç‡§Ø‡§æ‡§Æ': ['shyam', 'shyaam'], '‡§ó‡•ã‡§™‡§æ‡§≤': ['gopal', 'gopaal'],
    '‡§µ‡§ø‡§ú‡§Ø': ['vijay', 'vijaya'], '‡§∏‡§ø‡§Ç‡§π': ['singh', 'sing'], '‡§ï‡•Å‡§Æ‡§æ‡§∞': ['kumar', 'kumarr'],
    '‡§¶‡•á‡§µ‡•Ä': ['devi', 'devii'], '‡§™‡•ç‡§∞‡§∏‡§æ‡§¶': ['prasad', 'prasaad'], '‡§Ø‡§æ‡§¶‡§µ': ['yadav', 'yaadav'],
    '‡§∂‡§∞‡•ç‡§Æ‡§æ': ['sharma', 'sharmaa'], '‡§∏‡§ø‡§Ç‡§ß‡§ø‡§Ø‡§æ': ['sindhiya', 'sindhia'],
    // Village names
    '‡§∞‡§æ‡§Æ‡§™‡•Å‡§∞': ['rampur', 'raampurr'], '‡§∂‡§ø‡§µ‡§™‡•Å‡§∞': ['shivpur', 'shivpurr'], 
    '‡§ï‡•É‡§∑‡•ç‡§£‡§™‡•Å‡§∞': ['krishnapur', 'krishnpurr'], '‡§ó‡§Ç‡§ó‡§æ‡§™‡•Å‡§∞': ['gangapur', 'gangapurr'],
    '‡§π‡§®‡•Å‡§Æ‡§æ‡§®‡§™‡•Å‡§∞': ['hanumanpur', 'hanumaan'], '‡§≤‡§ï‡•ç‡§∑‡•ç‡§Æ‡•Ä‡§™‡•Å‡§∞': ['laxmipur', 'lakshmipur'],
    '‡§®‡§æ‡§∞‡§æ‡§Ø‡§£‡§™‡•Å‡§∞': ['narayanpur', 'naaraayan'], '‡§∞‡•Å‡§®‡•ç‡§®‡•Ä‡§∏‡•à‡§¶‡§™‡•Å‡§∞': ['runnisaidpur', 'runnisaipur']
};

// Enhanced demo voter data with both Hindi and English variants
const enhancedDemoVoterData = [
    {
        name: "‡§∞‡§æ‡§Æ ‡§ï‡•Å‡§Æ‡§æ‡§∞ ‡§∏‡§ø‡§Ç‡§π", name_en: "Ram Kumar Singh",
        father_name: "‡§∂‡•ç‡§Ø‡§æ‡§Æ ‡§ï‡•Å‡§Æ‡§æ‡§∞ ‡§∏‡§ø‡§Ç‡§π", father_name_en: "Shyam Kumar Singh",
        age: 45, voter_id: "ABC1234567",
        address: "‡§ó‡§æ‡§Ç‡§µ - ‡§∞‡§æ‡§Æ‡§™‡•Å‡§∞", address_en: "Village - Rampur",
        tehsil: "‡§∞‡•Å‡§®‡•ç‡§®‡•Ä‡§∏‡•à‡§¶‡§™‡•Å‡§∞", tehsil_en: "Runnisaidpur",
        post_office: "‡§∞‡§æ‡§Æ‡§™‡•Å‡§∞", post_office_en: "Rampur",
        booth: "001", gender: "M", house_no: "12/A"
    },
    {
        name: "‡§∏‡•Ä‡§§‡§æ ‡§¶‡•á‡§µ‡•Ä", name_en: "Sita Devi",
        father_name: "‡§ó‡•ã‡§™‡§æ‡§≤ ‡§∏‡§ø‡§Ç‡§π", father_name_en: "Gopal Singh",
        age: 38, voter_id: "DEF2345678",
        address: "‡§ó‡§æ‡§Ç‡§µ - ‡§∂‡§ø‡§µ‡§™‡•Å‡§∞", address_en: "Village - Shivpur",
        tehsil: "‡§∞‡•Å‡§®‡•ç‡§®‡•Ä‡§∏‡•à‡§¶‡§™‡•Å‡§∞", tehsil_en: "Runnisaidpur",
        post_office: "‡§∂‡§ø‡§µ‡§™‡•Å‡§∞", post_office_en: "Shivpur",
        booth: "002", gender: "F", house_no: "25/B"
    },
    {
        name: "‡§Ö‡§ú‡§Ø ‡§ï‡•Å‡§Æ‡§æ‡§∞ ‡§Ø‡§æ‡§¶‡§µ", name_en: "Ajay Kumar Yadav",
        father_name: "‡§∏‡•Å‡§∞‡•á‡§∂ ‡§Ø‡§æ‡§¶‡§µ", father_name_en: "Suresh Yadav",
        age: 29, voter_id: "GHI3456789",
        address: "‡§ó‡§æ‡§Ç‡§µ - ‡§ï‡•É‡§∑‡•ç‡§£‡§™‡•Å‡§∞", address_en: "Village - Krishnapur",
        tehsil: "‡§∞‡•Å‡§®‡•ç‡§®‡•Ä‡§∏‡•à‡§¶‡§™‡•Å‡§∞", tehsil_en: "Runnisaidpur",
        post_office: "‡§ï‡•É‡§∑‡•ç‡§£‡§™‡•Å‡§∞", post_office_en: "Krishnapur",
        booth: "001", gender: "M", house_no: "8/C"
    },
    {
        name: "‡§™‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§∂‡§∞‡•ç‡§Æ‡§æ", name_en: "Priya Sharma",
        father_name: "‡§∞‡§æ‡§ú‡•á‡§∂ ‡§∂‡§∞‡•ç‡§Æ‡§æ", father_name_en: "Rajesh Sharma",
        age: 25, voter_id: "JKL4567890",
        address: "‡§ó‡§æ‡§Ç‡§µ - ‡§ó‡§Ç‡§ó‡§æ‡§™‡•Å‡§∞", address_en: "Village - Gangapur",
        tehsil: "‡§∞‡•Å‡§®‡•ç‡§®‡•Ä‡§∏‡•à‡§¶‡§™‡•Å‡§∞", tehsil_en: "Runnisaidpur",
        post_office: "‡§ó‡§Ç‡§ó‡§æ‡§™‡•Å‡§∞", post_office_en: "Gangapur",
        booth: "003", gender: "F", house_no: "15/D"
    },
    {
        name: "‡§µ‡§ø‡§ï‡§æ‡§∏ ‡§∏‡§ø‡§Ç‡§π", name_en: "Vikas Singh",
        father_name: "‡§Æ‡§π‡•á‡§∂ ‡§∏‡§ø‡§Ç‡§π", father_name_en: "Mahesh Singh",
        age: 33, voter_id: "MNO5678901",
        address: "‡§ó‡§æ‡§Ç‡§µ - ‡§π‡§®‡•Å‡§Æ‡§æ‡§®‡§™‡•Å‡§∞", address_en: "Village - Hanumanpur",
        tehsil: "‡§∞‡•Å‡§®‡•ç‡§®‡•Ä‡§∏‡•à‡§¶‡§™‡•Å‡§∞", tehsil_en: "Runnisaidpur",
        post_office: "‡§π‡§®‡•Å‡§Æ‡§æ‡§®‡§™‡•Å‡§∞", post_office_en: "Hanumanpur",
        booth: "002", gender: "M", house_no: "30/E"
    },
    {
        name: "‡§∏‡•Å‡§®‡•Ä‡§§‡§æ ‡§ï‡•Å‡§Æ‡§æ‡§∞‡•Ä", name_en: "Sunita Kumari",
        father_name: "‡§∞‡§æ‡§Æ‡•á‡§∂‡•ç‡§µ‡§∞ ‡§™‡•ç‡§∞‡§∏‡§æ‡§¶", father_name_en: "Rameshwar Prasad",
        age: 42, voter_id: "PQR6789012",
        address: "‡§ó‡§æ‡§Ç‡§µ - ‡§≤‡§ï‡•ç‡§∑‡•ç‡§Æ‡•Ä‡§™‡•Å‡§∞", address_en: "Village - Laxmipur",
        tehsil: "‡§∞‡•Å‡§®‡•ç‡§®‡•Ä‡§∏‡•à‡§¶‡§™‡•Å‡§∞", tehsil_en: "Runnisaidpur",
        post_office: "‡§≤‡§ï‡•ç‡§∑‡•ç‡§Æ‡•Ä‡§™‡•Å‡§∞", post_office_en: "Laxmipur",
        booth: "001", gender: "F", house_no: "7/F"
    },
    {
        name: "‡§∞‡§æ‡§π‡•Å‡§≤ ‡§ï‡•Å‡§Æ‡§æ‡§∞", name_en: "Rahul Kumar",
        father_name: "‡§Ö‡§®‡§ø‡§≤ ‡§ï‡•Å‡§Æ‡§æ‡§∞", father_name_en: "Anil Kumar",
        age: 22, voter_id: "STU7890123",
        address: "‡§ó‡§æ‡§Ç‡§µ - ‡§®‡§æ‡§∞‡§æ‡§Ø‡§£‡§™‡•Å‡§∞", address_en: "Village - Narayanpur",
        tehsil: "‡§∞‡•Å‡§®‡•ç‡§®‡•Ä‡§∏‡•à‡§¶‡§™‡•Å‡§∞", tehsil_en: "Runnisaidpur",
        post_office: "‡§®‡§æ‡§∞‡§æ‡§Ø‡§£‡§™‡•Å‡§∞", post_office_en: "Narayanpur",
        booth: "003", gender: "M", house_no: "45/G"
    },
    {
        name: "‡§µ‡§ø‡§ú‡§Ø ‡§∏‡§ø‡§Ç‡§ß‡§ø‡§Ø‡§æ", name_en: "Vijay Sindhiya",
        father_name: "‡§≤‡§æ‡§≤‡•Ç ‡§™‡•ç‡§∞‡§∏‡§æ‡§¶ ‡§∏‡§ø‡§Ç‡§ß‡§ø‡§Ø‡§æ", father_name_en: "Lalu Prasad Sindhiya",
        age: 48, voter_id: "VJS9999999",
        address: "‡§ó‡§æ‡§Ç‡§µ - ‡§∞‡•Å‡§®‡•ç‡§®‡•Ä‡§∏‡•à‡§¶‡§™‡•Å‡§∞ ‡§Æ‡•Å‡§ñ‡•ç‡§Ø", address_en: "Village - Main Runnisaidpur",
        tehsil: "‡§∞‡•Å‡§®‡•ç‡§®‡•Ä‡§∏‡•à‡§¶‡§™‡•Å‡§∞", tehsil_en: "Runnisaidpur",
        post_office: "‡§∞‡•Å‡§®‡•ç‡§®‡•Ä‡§∏‡•à‡§¶‡§™‡•Å‡§∞", post_office_en: "Runnisaidpur",
        booth: "001", gender: "M", house_no: "1/A"
    },
    {
        name: "‡§∞‡§µ‡§ø ‡§™‡•ç‡§∞‡§§‡§æ‡§™", name_en: "Ravi Pratap",
        father_name: "‡§Ö‡§∂‡•ã‡§ï ‡§ï‡•Å‡§Æ‡§æ‡§∞", father_name_en: "Ashok Kumar",
        age: 35, voter_id: "RVI8888888",
        address: "‡§ó‡§æ‡§Ç‡§µ - ‡§°‡•á‡§µ‡§≤‡§™‡§∞ ‡§®‡§ó‡§∞", address_en: "Village - Developer Nagar",
        tehsil: "‡§∞‡•Å‡§®‡•ç‡§®‡•Ä‡§∏‡•à‡§¶‡§™‡•Å‡§∞", tehsil_en: "Runnisaidpur",
        post_office: "‡§°‡•á‡§µ‡§≤‡§™‡§∞ ‡§®‡§ó‡§∞", post_office_en: "Developer Nagar",
        booth: "002", gender: "M", house_no: "29/B"
    }
];

// Load voter data from JSON file
async function loadVoterData() {
    try {
        const response = await fetch('voter-data.json');
        if (response.ok) {
            voterData = await response.json();
            console.log('‚úÖ Voter data loaded successfully');
            
            // Add English variants if not present
            voterData = voterData.map(voter => ({
                ...voter,
                name_en: voter.name_en || transliterateToEnglish(voter.name),
                father_name_en: voter.father_name_en || transliterateToEnglish(voter.father_name),
                address_en: voter.address_en || transliterateToEnglish(voter.address),
                tehsil_en: voter.tehsil_en || transliterateToEnglish(voter.tehsil || '‡§∞‡•Å‡§®‡•ç‡§®‡•Ä‡§∏‡•à‡§¶‡§™‡•Å‡§∞'),
                post_office_en: voter.post_office_en || transliterateToEnglish(voter.post_office || '')
            }));
            
            updateVoterStats();
        } else {
            console.log('üìù Voter data file not found. Using demo data.');
            initializeDemoData();
        }
    } catch (error) {
        console.log('‚ö†Ô∏è Error loading voter data:', error);
        initializeDemoData();
    }
}

// Initialize with demo data
function initializeDemoData() {
    voterData = enhancedDemoVoterData;
    updateVoterStats();
    displayDataInstructions();
}

// Transliterate Hindi text to English (basic implementation)
function transliterateToEnglish(hindiText) {
    if (!hindiText) return '';
    
    let result = '';
    for (let char of hindiText) {
        result += hindiToEnglishMap[char] || char;
    }
    return result.toLowerCase();
}

// Transliterate English text to Hindi patterns
function transliterateToHindi(englishText) {
    if (!englishText) return '';
    
    let result = englishText.toLowerCase();
    // Convert common English patterns to Hindi equivalents
    Object.entries(englishToHindiMap).forEach(([eng, hin]) => {
        result = result.replace(new RegExp(eng, 'g'), hin);
    });
    return result;
}

// Enhanced universal search with multi-language support
function universalSearch(searchTerm) {
    if (!searchTerm || searchTerm.trim().length === 0) return [];
    
    const originalTerm = searchTerm.toLowerCase().trim();
    const searchTerms = [originalTerm];
    
    // Add transliterated versions
    if (isHindiText(originalTerm)) {
        searchTerms.push(transliterateToEnglish(originalTerm));
    } else {
        searchTerms.push(transliterateToHindi(originalTerm));
    }
    
    // Add name variations
    Object.entries(nameVariations).forEach(([hindi, englishVars]) => {
        if (originalTerm.includes(hindi.toLowerCase()) || 
            englishVars.some(eng => originalTerm.includes(eng.toLowerCase()))) {
            searchTerms.push(hindi.toLowerCase());
            searchTerms.push(...englishVars);
        }
    });
    
    console.log('üîç Search terms:', searchTerms);
    
    return voterData.filter(voter => {
        return searchTerms.some(term => {
            return Object.entries(voter).some(([key, value]) => {
                if (value && typeof value === 'string') {
                    const val = value.toLowerCase();
                    return val.includes(term) || 
                           (voter[key + '_en'] && voter[key + '_en'].toLowerCase().includes(term));
                }
                if (value && typeof value === 'number') {
                    return value.toString().includes(term);
                }
                return false;
            });
        });
    });
}

// Check if text contains Hindi characters
function isHindiText(text) {
    return /[\u0900-\u097F]/.test(text);
}

// Update voter statistics
function updateVoterStats() {
    searchStats.totalVoters = voterData.length;
    const maleCount = voterData.filter(v => v.gender === 'M').length;
    const femaleCount = voterData.filter(v => v.gender === 'F').length;
    
    // Update UI elements
    const totalVotersEl = document.getElementById('totalVoters');
    const maleVotersEl = document.getElementById('maleVoters');
    const femaleVotersEl = document.getElementById('femaleVoters');
    
    if (totalVotersEl) totalVotersEl.textContent = searchStats.totalVoters.toLocaleString();
    if (maleVotersEl) maleVotersEl.textContent = maleCount.toLocaleString();
    if (femaleVotersEl) femaleVotersEl.textContent = femaleCount.toLocaleString();
}

// Display instructions for data upload
function displayDataInstructions() {
    const resultsDiv = document.getElementById('searchResults');
    if (!resultsDiv) return;
    
    resultsDiv.innerHTML = `
        <div class="data-instructions">
            <h3>üéØ ‡§∞‡•Å‡§®‡•ç‡§®‡•Ä‡§∏‡•à‡§¶‡§™‡•Å‡§∞ ‡§µ‡§ø‡§ß‡§æ‡§®‡§∏‡§≠‡§æ ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞ 29 - ‡§Æ‡§§‡§¶‡§æ‡§§‡§æ ‡§°‡•á‡§ü‡§æ ‡§®‡§ø‡§∞‡•ç‡§¶‡•á‡§∂:</h3>
            <div class="demo-info">
                <p><strong>üöÄ ‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§Æ‡•á‡§Ç Demo Data ‡§â‡§™‡§≤‡§¨‡•ç‡§ß (${voterData.length} ‡§Æ‡§§‡§¶‡§æ‡§§‡§æ)</strong></p>
                <p><strong>üåü ‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§î‡§∞ English ‡§¶‡•ã‡§®‡•ã‡§Ç ‡§Æ‡•á‡§Ç search ‡§ï‡§∞‡•á‡§Ç!</strong></p>
                
                <div class="search-examples">
                    <h4>üìù Search Examples (Available Demo Names):</h4>
                    <div class="example-grid">
                        <div class="example-item">
                            <strong>Names:</strong> ‡§∞‡§æ‡§Æ, Ram, ‡§µ‡§ø‡§ú‡§Ø, Vijay, ‡§∞‡§µ‡§ø, Ravi, ‡§™‡•ç‡§∞‡§ø‡§Ø‡§æ, Priya
                        </div>
                        <div class="example-item">
                            <strong>Villages:</strong> ‡§∞‡§æ‡§Æ‡§™‡•Å‡§∞, Rampur, ‡§∂‡§ø‡§µ‡§™‡•Å‡§∞, Shivpur, ‡§ï‡•É‡§∑‡•ç‡§£‡§™‡•Å‡§∞
                        </div>
                        <div class="example-item">
                            <strong>Voter IDs:</strong> ABC123, DEF234, RVI888, VJS999
                        </div>
                        <div class="example-item">
                            <strong>Booths:</strong> 001, 002, 003
                        </div>
                    </div>
                    <div class="quick-test-buttons">
                        <h5>üîç Quick Test Searches:</h5>
                        <button onclick="testSearch('‡§∞‡§µ‡§ø')">‡§∞‡§µ‡§ø ‡§ñ‡•ã‡§ú‡•á‡§Ç</button>
                        <button onclick="testSearch('Ravi')">Ravi</button>
                        <button onclick="testSearch('‡§µ‡§ø‡§ú‡§Ø')">‡§µ‡§ø‡§ú‡§Ø</button>
                        <button onclick="testSearch('Ram')">Ram</button>
                        <button onclick="testSearch('002')">Booth 002</button>
                        <button onclick="testSearch('‡§∞‡§æ‡§Æ‡§™‡•Å‡§∞')">‡§∞‡§æ‡§Æ‡§™‡•Å‡§∞</button>
                    </div>
                </div>
            </div>
            
            <div class="data-upload-info">
                <h4>üìä ‡§Ö‡§™‡§®‡§æ ‡§°‡•á‡§ü‡§æ ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è:</h4>
                <ol>
                    <li>Excel ‡§´‡§º‡§æ‡§á‡§≤ "üéØ_FINAL_ALL_VOTERS.xlsx" ‡§ï‡•ã Python script ‡§∏‡•á convert ‡§ï‡§∞‡•á‡§Ç</li>
                    <li>Command: <code>python convert_excel_to_json.py</code></li>
                    <li>File ‡§ï‡•ã 'voter-data.json' ‡§®‡§æ‡§Æ ‡§∏‡•á save ‡§ï‡§∞‡•á‡§Ç</li>
                </ol>
            </div>
        </div>
    `;
}

// Specific field search with multi-language support
function searchByField(searchTerm, field) {
    if (!searchTerm) return [];
    
    const originalTerm = searchTerm.toLowerCase().trim();
    const searchTerms = [originalTerm];
    
    // Add transliterated versions for better matching
    if (isHindiText(originalTerm)) {
        searchTerms.push(transliterateToEnglish(originalTerm));
    } else {
        searchTerms.push(transliterateToHindi(originalTerm));
    }
    
    return voterData.filter(voter => {
        const fieldValue = voter[field] || voter[field + '_en'] || '';
        return searchTerms.some(term => 
            fieldValue.toString().toLowerCase().includes(term)
        );
    });
}

// Advanced search with multiple criteria
function advancedSearch(criteria) {
    return voterData.filter(voter => {
        return Object.entries(criteria).every(([field, value]) => {
            if (!value || value.trim() === '') return true; // Skip empty criteria
            
            const searchTerm = value.toLowerCase().trim();
            const voterValue = voter[field] || voter[field + '_en'] || '';
            
            // Multi-language search for each field
            const searchTerms = [searchTerm];
            if (isHindiText(searchTerm)) {
                searchTerms.push(transliterateToEnglish(searchTerm));
            } else {
                searchTerms.push(transliterateToHindi(searchTerm));
            }
            
            return searchTerms.some(term => 
                voterValue.toString().toLowerCase().includes(term)
            );
        });
    });
}

// Display search results with enhanced UI and language support
function displayResults(results, searchTerm = '') {
    const resultsDiv = document.getElementById('searchResults');
    const noResultsDiv = document.getElementById('noResults');
    
    if (!resultsDiv) return;
    
    searchStats.totalSearches++;
    searchStats.lastSearch = new Date();
    updateSearchStats();
    
    if (results.length === 0) {
        resultsDiv.innerHTML = `
            <div class="no-results-message">
                <h3>üòî ‡§ï‡•ã‡§à ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ</h3>
                <p>‡§ñ‡•ã‡§ú ‡§∂‡§¨‡•ç‡§¶: <strong>"${searchTerm}"</strong></p>
                <div class="search-suggestions">
                    <h4>üí° ‡§∏‡•Å‡§ù‡§æ‡§µ:</h4>
                    <ul>
                        <li>‚ú® ‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§î‡§∞ English ‡§¶‡•ã‡§®‡•ã‡§Ç ‡§Æ‡•á‡§Ç try ‡§ï‡§∞‡•á‡§Ç</li>
                        <li>üîç ‡§ï‡§Æ ‡§Ö‡§ï‡•ç‡§∑‡§∞ ‡§ü‡§æ‡§á‡§™ ‡§ï‡§∞‡•á‡§Ç (‡§ú‡•à‡§∏‡•á: ‡§∞‡§æ‡§Æ instead of ‡§∞‡§æ‡§Æ ‡§ï‡•Å‡§Æ‡§æ‡§∞)</li>
                        <li>üìù Spelling check ‡§ï‡§∞‡•á‡§Ç</li>
                        <li>üèòÔ∏è ‡§ó‡§æ‡§Ç‡§µ ‡§ï‡§æ ‡§®‡§æ‡§Æ try ‡§ï‡§∞‡•á‡§Ç</li>
                    </ul>
                </div>
            </div>
        `;
        if (noResultsDiv) noResultsDiv.style.display = 'none';
        return;
    }
    
    if (noResultsDiv) noResultsDiv.style.display = 'none';
    
    const resultsHTML = results.map((voter, index) => `
        <div class="voter-card enhanced-card" data-aos="fade-up" data-aos-delay="${index * 100}">
            <div class="voter-info">
                <h3>${highlightSearchTerm(voter.name, searchTerm)} 
                    <span class="english-name">(${highlightSearchTerm(voter.name_en || '', searchTerm)})</span></h3>
                <div class="voter-details">
                    <p><strong>üë®‚Äçüë¶ ‡§™‡§ø‡§§‡§æ ‡§ï‡§æ ‡§®‡§æ‡§Æ:</strong> ${highlightSearchTerm(voter.father_name, searchTerm)} 
                       <em>(${highlightSearchTerm(voter.father_name_en || '', searchTerm)})</em></p>
                    <p><strong>üéÇ ‡§Ü‡§Ø‡•Å:</strong> ${voter.age} ‡§µ‡§∞‡•ç‡§∑</p>
                    <p><strong>üÜî ‡§Æ‡§§‡§¶‡§æ‡§§‡§æ ID:</strong> <span class="voter-id">${highlightSearchTerm(voter.voter_id, searchTerm)}</span></p>
                    <p><strong>üè† ‡§™‡§§‡§æ:</strong> ${highlightSearchTerm(voter.address, searchTerm)} 
                       <em>(${highlightSearchTerm(voter.address_en || '', searchTerm)})</em></p>
                    <p><strong>üèõÔ∏è ‡§§‡§π‡§∏‡•Ä‡§≤:</strong> ${highlightSearchTerm(voter.tehsil || '‡§∞‡•Å‡§®‡•ç‡§®‡•Ä‡§∏‡•à‡§¶‡§™‡•Å‡§∞', searchTerm)} 
                       <em>(${highlightSearchTerm(voter.tehsil_en || 'Runnisaidpur', searchTerm)})</em></p>
                    <p><strong>üìÆ ‡§™‡•ã‡§∏‡•ç‡§ü ‡§ë‡§´‡§ø‡§∏:</strong> ${highlightSearchTerm(voter.post_office || 'N/A', searchTerm)} 
                       <em>(${highlightSearchTerm(voter.post_office_en || 'N/A', searchTerm)})</em></p>
                    <p><strong>üó≥Ô∏è ‡§¨‡•Ç‡§• ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ:</strong> <span class="booth-number">${highlightSearchTerm(voter.booth, searchTerm)}</span></p>
                    ${voter.house_no ? `<p><strong>üè° ‡§Æ‡§ï‡§æ‡§® ‡§®‡§Ç‡§¨‡§∞:</strong> ${voter.house_no}</p>` : ''}
                </div>
            </div>
            <div class="voter-actions">
                <span class="verified-badge">‚úì ‡§∏‡§§‡•ç‡§Ø‡§æ‡§™‡§ø‡§§</span>
                <span class="gender-badge ${voter.gender === 'M' ? 'male' : 'female'}">
                    ${voter.gender === 'M' ? 'üë® ‡§™‡•Å‡§∞‡•Å‡§∑' : 'üë© ‡§Æ‡§π‡§ø‡§≤‡§æ'}
                </span>
                <span class="constituency-badge">‡§µ‡§ø‡§ß‡§æ‡§®‡§∏‡§≠‡§æ 29</span>
            </div>
        </div>
    `).join('');
    
    resultsDiv.innerHTML = `
        <div class="results-header">
            <h3>üéØ ‡§ñ‡•ã‡§ú ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ - ‡§∞‡•Å‡§®‡•ç‡§®‡•Ä‡§∏‡•à‡§¶‡§™‡•Å‡§∞ ‡§µ‡§ø‡§ß‡§æ‡§®‡§∏‡§≠‡§æ ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞ 29</h3>
            <div class="search-info">
                <div class="results-count">${results.length} ‡§Æ‡§§‡§¶‡§æ‡§§‡§æ ‡§Æ‡§ø‡§≤‡•á (‡§ï‡•Å‡§≤ ${searchStats.totalVoters} ‡§Æ‡•á‡§Ç ‡§∏‡•á)</div>
                <div class="search-term">‡§ñ‡•ã‡§ú: "<strong>${searchTerm}</strong>"</div>
            </div>
        </div>
        <div class="results-grid">
            ${resultsHTML}
        </div>
        <div class="results-footer">
            <p><strong>üèõÔ∏è ‡§µ‡§ø‡§ß‡§æ‡§®‡§∏‡§≠‡§æ ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞:</strong> ‡§∞‡•Å‡§®‡•ç‡§®‡•Ä‡§∏‡•à‡§¶‡§™‡•Å‡§∞ (29), ‡§∏‡•Ä‡§§‡§æ‡§Æ‡§¢‡§º‡•Ä ‡§ú‡§ø‡§≤‡§æ</p>
            <p><strong>üåü ‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡§æ‡§∂‡•Ä:</strong> ‡§µ‡§ø‡§ú‡§Ø ‡§∏‡§ø‡§Ç‡§ß‡§ø‡§Ø‡§æ (‡§ú‡§® ‡§∏‡•Å‡§∞‡§æ‡§ú ‡§™‡§æ‡§∞‡•ç‡§ü‡•Ä)</p>
        </div>
    `;
    
    // Refresh AOS for new elements
    if (typeof AOS !== 'undefined') {
        AOS.refresh();
    }
}

// Enhanced highlight function with better matching
function highlightSearchTerm(text, searchTerm) {
    if (!searchTerm || !text) return text;
    
    const terms = [searchTerm];
    if (isHindiText(searchTerm)) {
        terms.push(transliterateToEnglish(searchTerm));
    } else {
        terms.push(transliterateToHindi(searchTerm));
    }
    
    let highlightedText = text;
    terms.forEach(term => {
        if (term.trim()) {
            const regex = new RegExp(`(${escapeRegExp(term)})`, 'gi');
            highlightedText = highlightedText.replace(regex, '<mark>$1</mark>');
        }
    });
    
    return highlightedText;
}

// Escape special regex characters
function escapeRegExp(string) {
    return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
}

// Update search statistics
function updateSearchStats() {
    const statsDiv = document.getElementById('searchStats');
    if (!statsDiv) return;
    
    const lastSearchTime = searchStats.lastSearch ? 
        searchStats.lastSearch.toLocaleTimeString() : '‡§ï‡§≠‡•Ä ‡§®‡§π‡•Ä‡§Ç';
    
    statsDiv.innerHTML = `
        <div class="stats-container">
            <div class="stats-item">
                <span class="stats-icon">üîç</span>
                <span class="stats-label">‡§ï‡•Å‡§≤ ‡§ñ‡•ã‡§ú‡•á‡§Ç:</span>
                <span class="stats-value">${searchStats.totalSearches}</span>
            </div>
            <div class="stats-item">
                <span class="stats-icon">üë•</span>
                <span class="stats-label">‡§ï‡•Å‡§≤ ‡§Æ‡§§‡§¶‡§æ‡§§‡§æ:</span>
                <span class="stats-value">${searchStats.totalVoters}</span>
            </div>
            <div class="stats-item">
                <span class="stats-icon">‚è∞</span>
                <span class="stats-label">‡§Ö‡§Ç‡§§‡§ø‡§Æ ‡§ñ‡•ã‡§ú:</span>
                <span class="stats-value">${lastSearchTime}</span>
            </div>
            <div class="stats-item">
                <span class="stats-icon">üèõÔ∏è</span>
                <span class="stats-label">‡§µ‡§ø‡§ß‡§æ‡§®‡§∏‡§≠‡§æ:</span>
                <span class="stats-value">‡§∞‡•Å‡§®‡•ç‡§®‡•Ä‡§∏‡•à‡§¶‡§™‡•Å‡§∞ (29)</span>
            </div>
        </div>
    `;
    statsDiv.style.display = 'block';
}

// Tab functionality for search
document.addEventListener('DOMContentLoaded', function() {
    const tabBtns = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.tab-content');
    
    tabBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            const targetTab = this.getAttribute('data-tab');
            
            // Remove active class from all tabs
            tabBtns.forEach(b => b.classList.remove('active'));
            tabContents.forEach(c => c.classList.add('hidden'));
            
            // Add active class to clicked tab
            this.classList.add('active');
            const targetContent = document.getElementById(`${targetTab}-search`);
            if (targetContent) {
                targetContent.classList.remove('hidden');
            }
        });
    });
});

// Enhanced form submission handlers
document.addEventListener('DOMContentLoaded', function() {
    const voterSearchForm = document.getElementById('voterSearchForm');
    
    if (voterSearchForm) {
        voterSearchForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const activeTab = document.querySelector('.tab-btn.active')?.getAttribute('data-tab') || 'quick';
            let results = [];
            let searchTerm = '';
            
            console.log('üîç Search initiated, active tab:', activeTab);
            
            if (activeTab === 'quick') {
                // Universal search
                const searchInput = document.getElementById('universalSearch');
                searchTerm = searchInput ? searchInput.value.trim() : '';
                
                console.log('üîç Quick search term:', searchTerm);
                
                if (searchTerm) {
                    results = universalSearch(searchTerm);
                    console.log('‚úÖ Search results:', results.length);
                } else {
                    alert('‡§ï‡•É‡§™‡§Ø‡§æ ‡§ñ‡•ã‡§ú ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•Å‡§õ ‡§ü‡§æ‡§á‡§™ ‡§ï‡§∞‡•á‡§Ç / Please type something to search');
                    return;
                }
            } else {
                // Advanced search
                const criteria = {
                    name: document.getElementById('searchName')?.value.trim() || '',
                    father_name: document.getElementById('searchFather')?.value.trim() || '',
                    age: document.getElementById('searchAge')?.value.trim() || '',
                    voter_id: document.getElementById('searchVoterID')?.value.trim() || '',
                    address: document.getElementById('searchAddress')?.value.trim() || '',
                    tehsil: document.getElementById('searchTehsil')?.value.trim() || '',
                    post_office: document.getElementById('searchPostOffice')?.value.trim() || '',
                    booth: document.getElementById('searchBooth')?.value.trim() || ''
                };
                
                console.log('üîç Advanced search criteria:', criteria);
                
                results = advancedSearch(criteria);
                searchTerm = Object.values(criteria).find(v => v) || '';
                
                if (!searchTerm) {
                    alert('‡§ï‡•É‡§™‡§Ø‡§æ ‡§ï‡§Æ ‡§∏‡•á ‡§ï‡§Æ ‡§è‡§ï ‡§´‡•Ä‡§≤‡•ç‡§° ‡§≠‡§∞‡•á‡§Ç / Please fill at least one field');
                    return;
                }
            }
            
            displayResults(results, searchTerm);
        });
    } else {
        console.error('‚ùå Voter search form not found!');
    }
});

// Clear search function
function clearSearch() {
    const form = document.getElementById('voterSearchForm');
    if (form) form.reset();
    
    const resultsDiv = document.getElementById('searchResults');
    const noResultsDiv = document.getElementById('noResults');
    const statsDiv = document.getElementById('searchStats');
    
    if (resultsDiv) resultsDiv.innerHTML = '';
    if (noResultsDiv) noResultsDiv.style.display = 'none';
    if (statsDiv) statsDiv.style.display = 'none';
    
    console.log('üóëÔ∏è Search cleared');
}

// Show search tips function
function showSearchTips() {
    const tipsDiv = document.querySelector('.search-tips') || createSearchTips();
    tipsDiv.style.display = tipsDiv.style.display === 'none' ? 'block' : 'none';
}

// Create enhanced search tips
function createSearchTips() {
    const tipsDiv = document.createElement('div');
    tipsDiv.className = 'search-tips';
    tipsDiv.innerHTML = `
        <h4>üîç ‡§ñ‡•ã‡§ú ‡§ï‡•á ‡§¨‡•á‡§π‡§§‡§∞‡•Ä‡§® ‡§ü‡§ø‡§™‡•ç‡§∏:</h4>
        <div class="tips-grid">
            <div class="tip-item">
                <strong>üåê ‡§≠‡§æ‡§∑‡§æ:</strong> ‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§î‡§∞ English ‡§¶‡•ã‡§®‡•ã‡§Ç ‡§Æ‡•á‡§Ç search ‡§ï‡§∞‡•á‡§Ç
            </div>
            <div class="tip-item">
                <strong>‚úÇÔ∏è ‡§õ‡•ã‡§ü‡•á ‡§∂‡§¨‡•ç‡§¶:</strong> ‡§∞‡§æ‡§Æ instead of ‡§∞‡§æ‡§Æ ‡§ï‡•Å‡§Æ‡§æ‡§∞ ‡§∏‡§ø‡§Ç‡§π
            </div>
            <div class="tip-item">
                <strong>üÜî ID Search:</strong> ABC123, DEF234 ‡§ú‡•à‡§∏‡•á parts ‡§≠‡•Ä ‡§ï‡§æ‡§Æ ‡§ï‡§∞‡•á‡§Ç‡§ó‡•á
            </div>
            <div class="tip-item">
                <strong>üèòÔ∏è ‡§ó‡§æ‡§Ç‡§µ:</strong> ‡§∞‡§æ‡§Æ‡§™‡•Å‡§∞, Rampur, ‡§∂‡§ø‡§µ‡§™‡•Å‡§∞ ‡§∏‡§≠‡•Ä ‡§ï‡§æ‡§Æ ‡§ï‡§∞‡•á‡§ó‡§æ
            </div>
            <div class="tip-item">
                <strong>üó≥Ô∏è ‡§¨‡•Ç‡§•:</strong> 001, 002 ‡§∏‡•á ‡§∏‡§≠‡•Ä ‡§Æ‡§§‡§¶‡§æ‡§§‡§æ ‡§¶‡•á‡§ñ‡•á‡§Ç
            </div>
            <div class="tip-item">
                <strong>üì± Mobile:</strong> Touch friendly interface
            </div>
        </div>
        <div class="example-searches">
            <h5>‡§â‡§¶‡§æ‡§π‡§∞‡§£ ‡§ñ‡•ã‡§ú‡•á‡§Ç:</h5>
            <button onclick="testSearch('‡§∞‡§µ‡§ø')">‡§∞‡§µ‡§ø ‡§™‡•ç‡§∞‡§§‡§æ‡§™</button>
            <button onclick="testSearch('Ravi')">Ravi Pratap</button>
            <button onclick="testSearch('‡§µ‡§ø‡§ú‡§Ø')">‡§µ‡§ø‡§ú‡§Ø</button>
            <button onclick="testSearch('Ram')">Ram</button>
            <button onclick="testSearch('001')">‡§¨‡•Ç‡§• 001</button>
            <button onclick="testSearch('‡§∞‡§æ‡§Æ‡§™‡•Å‡§∞')">‡§∞‡§æ‡§Æ‡§™‡•Å‡§∞</button>
        </div>
    `;
    
    const searchForm = document.querySelector('.search-form');
    if (searchForm) {
        searchForm.appendChild(tipsDiv);
    }
    
    return tipsDiv;
}

// Real-time search as user types (debounced)
function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}

// Add real-time search functionality
document.addEventListener('DOMContentLoaded', function() {
    const universalSearchInput = document.getElementById('universalSearch');
    if (universalSearchInput) {
        const debouncedSearch = debounce((searchTerm) => {
            if (searchTerm.length >= 2) {
                console.log('üîç Real-time search:', searchTerm);
                const results = universalSearch(searchTerm);
                displayResults(results, searchTerm);
            } else if (searchTerm.length === 0) {
                clearSearch();
            }
        }, 500);
        
        universalSearchInput.addEventListener('input', (e) => {
            debouncedSearch(e.target.value);
        });
        
        // Add placeholder animation
        universalSearchInput.addEventListener('focus', function() {
            this.setAttribute('data-placeholder', this.placeholder);
            this.placeholder = '‡§ü‡§æ‡§á‡§™ ‡§ï‡§∞‡§®‡§æ ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç... Start typing...';
        });
        
        universalSearchInput.addEventListener('blur', function() {
            this.placeholder = this.getAttribute('data-placeholder') || this.placeholder;
        });
    }
});

// Volunteer modal functionality (unchanged)
document.addEventListener('DOMContentLoaded', function() {
    const volunteerBtns = document.querySelectorAll('.volunteer-btn');
    const modal = document.getElementById('volunteerModal');
    const closeBtn = modal ? modal.querySelector('.close') : null;
    const volunteerForm = document.getElementById('volunteerForm');
    
    volunteerBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            const volunteerType = this.getAttribute('data-type');
            if (modal) {
                modal.style.display = 'block';
                document.getElementById('volunteerType').value = volunteerType;
                
                const titles = {
                    'promotion': '‡§™‡•ç‡§∞‡§ö‡§æ‡§∞ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡§∞‡•ç‡§§‡§æ ‡§¨‡§®‡•á‡§Ç',
                    'community': '‡§∏‡§æ‡§Æ‡•Å‡§¶‡§æ‡§Ø‡§ø‡§ï ‡§∏‡•á‡§µ‡§æ ‡§Æ‡•á‡§Ç ‡§ú‡•Å‡§°‡§º‡•á‡§Ç',
                    'election': '‡§ö‡•Å‡§®‡§æ‡§µ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡§∞‡•ç‡§§‡§æ ‡§¨‡§®‡•á‡§Ç',
                    'digital': '‡§°‡§ø‡§ú‡§ø‡§ü‡§≤ ‡§™‡•ç‡§∞‡§Æ‡•ã‡§ü‡§∞ ‡§¨‡§®‡•á‡§Ç'
                };
                modal.querySelector('h3').textContent = titles[volunteerType];
            }
        });
    });
    
    if (closeBtn) {
        closeBtn.addEventListener('click', function() {
            modal.style.display = 'none';
        });
    }
    
    if (volunteerForm) {
        volunteerForm.addEventListener('submit', function(e) {
            e.preventDefault();
            alert('üéâ ‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶! ‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§µ‡§Ø‡§Ç‡§∏‡•á‡§µ‡§ï ‡§™‡§Ç‡§ú‡•Ä‡§ï‡§∞‡§£ ‡§∏‡§´‡§≤ ‡§∞‡§π‡§æ‡•§ ‡§µ‡§ø‡§ú‡§Ø ‡§∏‡§ø‡§Ç‡§ß‡§ø‡§Ø‡§æ ‡§ï‡•Ä ‡§ü‡•Ä‡§Æ ‡§ú‡§≤‡•ç‡§¶ ‡§π‡•Ä ‡§Ü‡§™‡§∏‡•á ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§ï‡§∞‡•á‡§ó‡•Ä‡•§');
            modal.style.display = 'none';
            this.reset();
        });
    }
    
    window.addEventListener('click', function(e) {
        if (e.target === modal) {
            modal.style.display = 'none';
        }
    });
});

// Enhanced feedback functionality
document.addEventListener('DOMContentLoaded', function() {
    const feedbackForm = document.querySelector('.feedback-form');
    const stars = document.querySelectorAll('.star');
    
    stars.forEach((star, index) => {
        star.addEventListener('click', function() {
            const rating = this.getAttribute('data-rating');
            
            stars.forEach((s, i) => {
                if (i >= stars.length - rating) {
                    s.classList.add('active');
                } else {
                    s.classList.remove('active');
                }
            });
        });
        
        star.addEventListener('mouseover', function() {
            const rating = this.getAttribute('data-rating');
            
            stars.forEach((s, i) => {
                if (i >= stars.length - rating) {
                    s.style.color = '#FFE66D';
                } else {
                    s.style.color = '#ddd';
                }
            });
        });
    });
    
    const starRating = document.querySelector('.star-rating');
    if (starRating) {
        starRating.addEventListener('mouseleave', function() {
            stars.forEach(star => {
                if (!star.classList.contains('active')) {
                    star.style.color = '#ddd';
                } else {
                    star.style.color = '#FFE66D';
                }
            });
        });
    }
    
    if (feedbackForm) {
        feedbackForm.addEventListener('submit', function(e) {
            e.preventDefault();
            alert('üôè ‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶ ‡§Ü‡§™‡§ï‡•Ä ‡§∞‡§æ‡§Ø ‡§ï‡•á ‡§≤‡§ø‡§è! ‡§µ‡§ø‡§ú‡§Ø ‡§∏‡§ø‡§Ç‡§ß‡§ø‡§Ø‡§æ ‡§î‡§∞ ‡§ú‡§® ‡§∏‡•Å‡§∞‡§æ‡§ú ‡§™‡§æ‡§∞‡•ç‡§ü‡•Ä ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ü‡§™‡§ï‡•Ä ‡§´‡•Ä‡§°‡§¨‡•à‡§ï ‡§¨‡§π‡•Å‡§§ ‡§Æ‡§π‡§§‡•ç‡§µ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§π‡•à‡•§');
            this.reset();
            stars.forEach(star => star.classList.remove('active'));
        });
    }
});

// Contact form handler
document.addEventListener('DOMContentLoaded', function() {
    const contactForm = document.querySelector('.contact-form');
    
    if (contactForm) {
        contactForm.addEventListener('submit', function(e) {
            e.preventDefault();
            alert('üìû ‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶! ‡§Ü‡§™‡§ï‡§æ ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§µ‡§ø‡§ú‡§Ø ‡§∏‡§ø‡§Ç‡§ß‡§ø‡§Ø‡§æ ‡§§‡§ï ‡§™‡§π‡•Å‡§Ç‡§ö‡§æ‡§Ø‡§æ ‡§ú‡§æ‡§è‡§ó‡§æ‡•§ ‡§π‡§Æ ‡§ú‡§≤‡•ç‡§¶ ‡§π‡•Ä ‡§Ü‡§™‡§∏‡•á ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§ï‡§∞‡•á‡§Ç‡§ó‡•á‡•§');
            this.reset();
        });
    }
});

// Header scroll effect
window.addEventListener('scroll', () => {
    const header = document.querySelector('.header');
    if (header) {
        if (window.scrollY > 100) {
            header.classList.add('scrolled');
        } else {
            header.classList.remove('scrolled');
        }
    }
});

// Enhanced booth finder with multi-language support
document.addEventListener('DOMContentLoaded', function() {
    const boothSearch = document.getElementById('boothSearch');
    const boothResults = document.getElementById('boothResults');
    
    if (boothSearch && boothResults) {
        boothSearch.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase().trim();
            
            if (searchTerm.length < 2) {
                boothResults.innerHTML = '';
                return;
            }
            
            const boothInfo = voterData.reduce((acc, voter) => {
                const matchesSearch = 
                    voter.address.toLowerCase().includes(searchTerm) ||
                    (voter.address_en && voter.address_en.toLowerCase().includes(searchTerm)) ||
                    voter.post_office.toLowerCase().includes(searchTerm) ||
                    (voter.post_office_en && voter.post_office_en.toLowerCase().includes(searchTerm));
                
                if (matchesSearch) {
                    if (!acc[voter.booth]) {
                        acc[voter.booth] = {
                            booth: voter.booth,
                            address: voter.address,
                            address_en: voter.address_en,
                            post_office: voter.post_office,
                            post_office_en: voter.post_office_en,
                            count: 0
                        };
                    }
                    acc[voter.booth].count++;
                }
                return acc;
            }, {});
            
            const results = Object.values(boothInfo);
            
            if (results.length > 0) {
                boothResults.innerHTML = results.map(booth => `
                    <div class="booth-result">
                        <strong>üó≥Ô∏è ‡§¨‡•Ç‡§• ${booth.booth}</strong><br>
                        üìç ${booth.address} <em>(${booth.address_en || ''})</em><br>
                        üìÆ ${booth.post_office} <em>(${booth.post_office_en || ''})</em><br>
                        üë• ${booth.count} ‡§Æ‡§§‡§¶‡§æ‡§§‡§æ<br>
                        <small>üèõÔ∏è ‡§µ‡§ø‡§ß‡§æ‡§®‡§∏‡§≠‡§æ ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞: ‡§∞‡•Å‡§®‡•ç‡§®‡•Ä‡§∏‡•à‡§¶‡§™‡•Å‡§∞ (29)</small>
                    </div>
                `).join('');
            } else {
                boothResults.innerHTML = `
                    <div class="no-booth-found">
                        <p>üòî ‡§ï‡•ã‡§à ‡§¨‡•Ç‡§• ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ‡•§</p>
                        <small>‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§Ø‡§æ English ‡§Æ‡•á‡§Ç try ‡§ï‡§∞‡•á‡§Ç</small>
                    </div>
                `;
            }
        });
    }
});

// Test search function for example buttons
function testSearch(searchTerm) {
    const searchInput = document.getElementById('universalSearch');
    if (searchInput) {
        searchInput.value = searchTerm;
        const results = universalSearch(searchTerm);
        displayResults(results, searchTerm);
        
        // Scroll to results
        const resultsDiv = document.getElementById('searchResults');
        if (resultsDiv) {
            resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
    }
}

// Initialize everything
document.addEventListener('DOMContentLoaded', () => {
    console.log('üöÄ Initializing Jan Suraj Party Website...');
    
    // Load voter data
    loadVoterData();
    
    // Initialize animations observer for new elements
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('animate-in');
            }
        });
    }, observerOptions);

    // Observe elements for animation
    const animateElements = document.querySelectorAll('.manifesto-card, .voter-card, .volunteer-card, .info-card');
    animateElements.forEach(el => observer.observe(el));
    
    console.log('‚úÖ Jan Suraj Party Website Initialized Successfully! üéØ');
    console.log('üèõÔ∏è ‡§∞‡•Å‡§®‡•ç‡§®‡•Ä‡§∏‡•à‡§¶‡§™‡•Å‡§∞ ‡§µ‡§ø‡§ß‡§æ‡§®‡§∏‡§≠‡§æ ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞ 29 - ‡§µ‡§ø‡§ú‡§Ø ‡§∏‡§ø‡§Ç‡§ß‡§ø‡§Ø‡§æ');
    console.log('üåü ‡§¨‡§ø‡§π‡§æ‡§∞ ‡§ï‡•á ‡§¨‡§¶‡§≤‡§æ‡§µ ‡§ï‡•á ‡§≤‡§ø‡§è - ‡§ú‡§® ‡§∏‡•Å‡§∞‡§æ‡§ú ‡§™‡§æ‡§∞‡•ç‡§ü‡•Ä üöÄ');
});

// Add enhanced CSS styles for new elements
const enhancedStyles = `
<style>
.constituency-number {
    font-size: 0.8rem;
    color: rgba(255, 255, 255, 0.9);
    font-weight: 600;
}

.constituency-details {
    background: rgba(255, 255, 255, 0.1);
    padding: 15px;
    border-radius: 10px;
    margin-bottom: 20px;
    backdrop-filter: blur(5px);
}

.constituency-details p {
    margin: 5px 0;
    font-size: 0.95rem;
}

.enhanced-card {
    position: relative;
    overflow: hidden;
}

.enhanced-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,107,53,0.1), transparent);
    transition: left 0.5s;
}

.enhanced-card:hover::before {
    left: 100%;
}

.english-name {
    font-size: 0.9rem;
    color: var(--text-light);
    font-weight: normal;
}

.voter-details p em {
    color: var(--text-light);
    font-size: 0.85rem;
}

.voter-id, .booth-number {
    font-family: monospace;
    background: var(--light-color);
    padding: 2px 6px;
    border-radius: 4px;
    font-weight: bold;
}

.constituency-badge {
    background: linear-gradient(135deg, #FF6B35, #F7931E);
    color: white;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 0.7rem;
    font-weight: 600;
    margin-top: 5px;
    display: inline-block;
}

.search-info {
    display: flex;
    justify-content: center;
    gap: 20px;
    flex-wrap: wrap;
    margin-top: 10px;
}

.search-term {
    background: var(--light-color);
    padding: 8px 15px;
    border-radius: 20px;
    font-size: 0.9rem;
}

.results-footer {
    text-align: center;
    margin-top: 30px;
    padding: 20px;
    background: var(--light-color);
    border-radius: 15px;
    border-top: 3px solid var(--primary-color);
}

.no-results-message {
    text-align: center;
    padding: 40px;
    background: var(--light-color);
    border-radius: 20px;
    margin: 20px 0;
}

.search-suggestions {
    margin-top: 20px;
    text-align: left;
    max-width: 400px;
    margin-left: auto;
    margin-right: auto;
}

.search-suggestions ul {
    list-style: none;
    padding: 0;
}

.search-suggestions li {
    padding: 8px 0;
    border-bottom: 1px solid #eee;
}

.demo-info {
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    color: white;
    padding: 20px;
    border-radius: 15px;
    margin-bottom: 25px;
}

.search-examples {
    margin-top: 15px;
}

.example-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 10px;
    margin-top: 10px;
}

.example-item {
    background: rgba(255, 255, 255, 0.1);
    padding: 10px;
    border-radius: 8px;
    backdrop-filter: blur(5px);
}

.data-upload-info {
    background: var(--white);
    padding: 20px;
    border-radius: 15px;
    border-left: 5px solid var(--primary-color);
}

.stats-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
}

.stats-item {
    display: flex;
    align-items: center;
    gap: 8px;
    background: var(--white);
    padding: 10px;
    border-radius: 10px;
    box-shadow: var(--shadow);
}

.stats-icon {
    font-size: 1.2rem;
}

.tips-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 10px;
    margin-bottom: 15px;
}

.tip-item {
    background: rgba(255, 255, 255, 0.1);
    padding: 10px;
    border-radius: 8px;
    font-size: 0.9rem;
}

.example-searches button,
.quick-test-buttons button {
    background: var(--primary-color);
    color: white;
    border: none;
    padding: 8px 12px;
    border-radius: 15px;
    margin: 5px;
    cursor: pointer;
    font-size: 0.8rem;
    transition: all 0.3s ease;
}

.example-searches button:hover,
.quick-test-buttons button:hover {
    background: var(--secondary-color);
    transform: translateY(-2px);
    box-shadow: var(--shadow);
}

.quick-test-buttons {
    margin-top: 15px;
    text-align: center;
    padding: 15px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    backdrop-filter: blur(5px);
}

.quick-test-buttons h5 {
    color: white;
    margin-bottom: 10px;
    font-size: 1rem;
}

.no-booth-found {
    text-align: center;
    padding: 20px;
    background: var(--light-color);
    border-radius: 10px;
    color: var(--text-light);
}

/* Mobile optimizations */
@media (max-width: 768px) {
    .search-info {
        flex-direction: column;
        gap: 10px;
    }
    
    .example-grid {
        grid-template-columns: 1fr;
    }
    
    .stats-container {
        grid-template-columns: 1fr 1fr;
    }
    
    .tips-grid {
        grid-template-columns: 1fr;
    }
    
    .english-name {
        display: block;
        margin-top: 5px;
    }
    
    .voter-details p em {
        display: block;
        margin-top: 2px;
    }
}
</style>
`;

// Inject enhanced styles
document.head.insertAdjacentHTML('beforeend', enhancedStyles);